<!DOCTYPE html>
<html lang="en">
    <head>
        <title>LinkPlayer</title>
        <link rel="stylesheet" type="text/css" href="../static/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-deep_purple.min.css" />
    </head>
    <body>

      <div id="player" style="visibility: hidden; position: absolute;"></div>

<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header" style="border-radius:5px;">
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <!-- Title -->
        <span class="mdl-layout-title">LinkPlayer</span>
        <!-- Add spacer, to align navigation to the right -->
        <div class="mdl-layout-spacer"></div>
        <!-- Navigation. We hide it in small screens. -->
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link material-icons" href="javascript:minimize()">minimize</a>
          <a class="mdl-navigation__link material-icons" href="javascript:close()">clear</a>
        </nav>
      </div>
    </header>
    <main class="mdl-layout__content">
      <div class="page-content">
        <form action="#" class="new_song">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <input class="mdl-textfield__input" type="text" id="sample3">
              <label class="mdl-textfield__label" for="sample3">Link to the song...</label>
            </div>
            <input type="submit" value="Add" onclick="add_new_song()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
          </form>
        <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
            <thead>
              <tr>

                <th class="mdl-data-table__cell--non-numeric">Song name</th>
                <th class="mdl-data-table__cell--non-numeric">URL</th>
                <th>Lenght</th>
                <th class="mdl-data-table__cell--non-numeric">Play</th>
                <th class="mdl-data-table__cell--non-numeric">Delete</th>
              </tr>
            </thead>
            <tbody>

            </tbody>
          </table>

          <div class="bottom_line" style="border-radius-bottom-left:10px; border-radius-bottom-right:10px;">
            <span class="current_song">
              <p>None</p>
            </span>

            <span class="controls">
              <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-color--accent">
                <i class="material-icons">navigate_before</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-color--accent" onclick="pause_or_play()">
                <i class="material-icons" id="pause_button">play_arrow</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-color--accent">
                <i class="material-icons">navigate_next</i>
              </button>
            </span>

            <span class="volume_control">
              <input class="mdl-slider mdl-js-slider" type="range"
              min="0" max="100" value="50" tabindex="0" onchange="change_volume()" name="current_volume">
            </span>

          </div>
      </div>
    </main>
  </div>
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script>
    const YTPlayer = require('yt-player');
    const player = new YTPlayer('#player');
    let playing = false;
    let current_time = 0;

    function close(){
        const remote = require('electron').remote;
        let current_window = remote.getCurrentWindow();
        current_window.close();
    }

    function minimize(){
        const remote = require('electron').remote;
        let current_window = remote.getCurrentWindow();
        current_window.minimize();
    }

    function change_volume(){
      player.setVolume(parseInt(document.getElementsByName('current_volume')[0].value));
    }

    function set_and_play_new_song(url, song_name){
      player.load(url);
      player.setVolume(parseInt(document.getElementsByName('current_volume')[0].value));
      player.play();
      document.querySelector('.current_song p').textContent = song_name;
      document.getElementById('pause_button').textContent = "pause";
      playing = true;
    }

    function get_song_list(){
      let handlejson = require('../handlejson');
      let songs = handlejson.read_songs_file();
      return songs.songs_list;
    }

    function add_new_song(){
      let url = document.getElementById('sample3').value;
      let handle_new_songs = require('../handle_new_songs');
      handle_new_songs.YTadd_new_song(url);
      fill_table_with_songs();
    }

    function fill_table_with_songs(){
      songs = get_song_list();
      document.getElementsByTagName('tbody')[0].innerHTML = "";
      songs.forEach(function (song) {
        document.getElementsByTagName('tbody')[0].innerHTML += `<tr class="custom_hover">
                <td class="mdl-data-table__cell--non-numeric">${song.url}</td>
                <td class="song_url">${song.url}</td>
                <td>30:15</td>
                <td><button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="set_and_play_new_song('${song.url}', '${song.url}')">
                  Play
                </button></td>
                <td><button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">
                  Delete
                </button></td>
              </tr>`
      });
    }

    function pause_or_play(){
      if(playing===true) {
        player.pause();
        document.getElementById('pause_button').textContent = "pause";
        playing = false;
      } else{
        player.play();
        document.getElementById('pause_button').textContent = "play_arrow";
        playing = true;
      }
    }

    fill_table_with_songs();
</script>
  </body>
</html>
